# V4 待办功能与设计想法

## 待办事项

### [ ] 时间系统与 LLM 解耦

**优先级**: 高 | **类型**: 架构重构

当前时间推进依赖 agentic 工具调用（`update_time`），由 LLM 决定是否/何时推进时间。问题在于：

- LLM 可能遗忘推进时间，导致时间停滞
- 时间推进粒度不一致（有时跳太多，有时不动）
- 时间本质上是世界机械层的一部分，不应由叙述层控制

**目标设计**: 时间作为世界底层运行时的一部分，随玩家操作自动流逝：

- 地点移动 → 根据距离自动消耗旅行时间
- 环境操作（探索/搜索/休息）→ 消耗对应时长
- NPC 对话 → 每轮对话消耗少量时间
- 战斗 → 根据回合数消耗时间
- LLM 仅保留"等待/休息"等显式时间跳跃的控制权

**实现思路**: 在 `SessionRuntime` / `AreaRuntime` 层注入时间消耗规则，各工具执行后自动调用 `session.advance_time(minutes)` 而非由 LLM 主动调用 `update_time` 工具。

---

### [ ] 完整商店系统

**优先级**: 中 | **类型**: 新功能

实现可交互的商店/交易系统，支持买卖物品、讨价还价、NPC 好感影响价格等。

---


环境掷骰检定，这个真得做做吧！