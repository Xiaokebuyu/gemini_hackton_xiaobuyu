# 世界观图谱输出规范（LLM 批量抽取）

本文档定义 LLM 批量抽取时的输出格式、字段要求与 ID 规则。

---

## 1. 输出结构（必须是 JSON）

```
{
  "nodes": [ ... ],
  "edges": [ ... ]
}
```

### Node 必需字段
- `id`：唯一 ID（字符串）
- `type`：节点类型（NodeType）
- `name`：显示名（字符串）

### Node 可选字段
- `importance`：0~1 的重要度
- `properties`：任意附加字段（对象）

### Edge 必需字段
- `id`：唯一 ID（字符串）
- `source`：起点节点 ID
- `target`：终点节点 ID
- `relation`：关系类型（RelationType）

### Edge 可选字段
- `weight`：0~1 的权重
- `properties`：任意附加字段（对象）

---

## 2. NodeType（当前支持）

- identity
- person
- location
- event
- rumor
- knowledge
- item
- organization
- goal
- emotion
- location_ref
- person_ref
- item_ref

---

## 3. RelationType（当前支持）

- located_in
- part_of
- owns
- works_at
- family
- friend
- enemy
- colleague
- knows
- participated
- witnessed
- heard_about
- caused
- believes
- suspects
- knows_that
- likes
- fears
- trusts
- hates
- refers_to

---

## 4. ID 规则（强烈建议）

确保稳定、确定性、可复用：

- 人物：`person_<slug>`
- 地点：`location_<slug>`
- 组织：`org_<slug>`（如需，可先映射为 `knowledge` 或 `item`）
- 物品：`item_<slug>`
- 事件：`event_<slug>`

若同一实体跨多个 chunk 重复出现，必须复用同一 ID。

---

## 5. Event 事件节点建议字段

`properties` 中推荐包含：
- `day`：游戏日
- `summary`：简短描述

---

## 6. 合并与去重建议

批量抽取完成后建议：
1) 使用 `graph_review` 生成统计与错误报告  
2) 使用 `graph_merge` 进行去重/别名合并  
3) 导入 Firestore，再运行索引重建  
