# ğŸ¯ é¡¹ç›®é€Ÿè§ˆ - LLMçƒ­è®°å¿†ç³»ç»Ÿ

> **ä¸€å¥è¯æ¦‚æ‹¬**: ä¸€ä¸ªå¸¦æœ‰æ™ºèƒ½ä¸Šä¸‹æ–‡ç®¡ç†çš„å¯¹è¯ç³»ç»Ÿï¼Œä¼šè‡ªåŠ¨å½’æ¡£å†å²å¯¹è¯å¹¶åœ¨éœ€è¦æ—¶æ£€ç´¢ç›¸å…³å†…å®¹

---

## ğŸ“Œ æ ¸å¿ƒåŠŸèƒ½

1. **å¯¹è¯ç®¡ç†** - ç”¨æˆ·å¯ä»¥åˆ›å»ºä¼šè¯(Session)è¿›è¡Œå¤šè½®å¯¹è¯
2. **è‡ªåŠ¨å½’æ¡£** - å½“å¯¹è¯ç§¯ç´¯ä¸€å®šé‡åï¼Œè‡ªåŠ¨åˆ†æå½’æ¡£ä¸ºä¸»é¢˜(Topic)
3. **æ™ºèƒ½æ£€ç´¢** - å½“AIéœ€è¦å†å²ä¿¡æ¯æ—¶ï¼Œä¼šæ ‡è®°`NEED_CONTEXT`å¹¶æ£€ç´¢ç›¸å…³Artifact
4. **ç‰ˆæœ¬ç®¡ç†** - æ¯ä¸ªä¸»é¢˜çš„Artifactæœ‰ç‰ˆæœ¬å†å²å¯è¿½æº¯

---

## ğŸ—‚ï¸ é¡¹ç›®ç»“æ„

```
gemini-hackton/
â”œâ”€â”€ backend/              # FastAPI åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py      # å…¥å£æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ config.py    # é…ç½®ä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ routers/     # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ chat.py      # å¯¹è¯ç›¸å…³æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ topics.py    # ä¸»é¢˜æŸ¥è¯¢æ¥å£
â”‚   â”‚   â”œâ”€â”€ services/    # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ context_loop.py     # ä¸Šä¸‹æ–‡å¾ªç¯(æ ¸å¿ƒï¼)
â”‚   â”‚   â”‚   â”œâ”€â”€ context_builder.py  # ä¸Šä¸‹æ–‡æ„å»º
â”‚   â”‚   â”‚   â”œâ”€â”€ archive_service.py  # å½’æ¡£æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ artifact_service.py # Artifactè§£æ
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_service.py      # LLMè°ƒç”¨
â”‚   â”‚   â”‚   â””â”€â”€ firestore_service.py # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â””â”€â”€ models/      # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ run.sh
â”‚
â”œâ”€â”€ frontend/             # ç®€å•å‰ç«¯ç•Œé¢
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ app.js
â”‚   â””â”€â”€ styles.css
â”‚
â””â”€â”€ æ–½å·¥æ–‡æ¡£/             # å¼€å‘æ–‡æ¡£
    â”œâ”€â”€ 00-é¡¹ç›®é€Ÿè§ˆ.md         # ğŸ‘ˆ å½“å‰æ–‡ä»¶
    â”œâ”€â”€ 01-å¿«é€Ÿæ£€æŸ¥æ¸…å•.md     # å¼€å‘çŠ¶æ€æ£€æŸ¥
    â”œâ”€â”€ æ¶æ„å›¾.md              # ç³»ç»Ÿæ¶æ„å›¾
    â””â”€â”€ firestoreè¯¦ç»†æ–½å·¥æ–¹æ¡ˆ.md # è¯¦ç»†è®¾è®¡æ–‡æ¡£

```

---

## ğŸ”„ æ ¸å¿ƒæµç¨‹ï¼ˆ5æ­¥èµ°ï¼‰

### 1ï¸âƒ£ ç”¨æˆ·å‘é€æ¶ˆæ¯
```
POST /api/chat
â†’ ä¿å­˜ç”¨æˆ·æ¶ˆæ¯åˆ° Firestore
```

### 2ï¸âƒ£ æ£€æŸ¥æ˜¯å¦éœ€è¦å½’æ¡£
```
archive_service.check_should_archive()
â†’ åˆ¤æ–­æœªå½’æ¡£æ¶ˆæ¯æ•° >= archive_threshold
â†’ å¦‚æœè¾¾åˆ°é˜ˆå€¼ï¼Œæ‰§è¡Œå½’æ¡£
```

### 3ï¸âƒ£ ä¸Šä¸‹æ–‡å¾ªç¯ï¼ˆé‡ç‚¹ï¼ï¼‰
```
context_loop.run()
â†’ æ„å»ºä¸Šä¸‹æ–‡ï¼ˆæœ€è¿‘Næ¡æ¶ˆæ¯ + æ‰€æœ‰Artifactsæ‘˜è¦ï¼‰
â†’ è°ƒç”¨LLMç”Ÿæˆå›å¤
â†’ æ£€æµ‹å›å¤ä¸­æ˜¯å¦æœ‰ NEED_CONTEXT æ ‡è®°
â†’ å¦‚æœæœ‰ï¼Œæå–å…³é”®è¯å¹¶æŸ¥æ‰¾ç›¸å…³Artifactå†…å®¹
â†’ é‡æ–°æ„å»ºä¸Šä¸‹æ–‡å¹¶å†æ¬¡è°ƒç”¨LLM
â†’ æœ€å¤šé‡è¯• max_context_retry æ¬¡
```

### 4ï¸âƒ£ ä¿å­˜åŠ©æ‰‹å›å¤
```
â†’ ä¿å­˜æœ€ç»ˆå›å¤åˆ° Firestore
```

### 5ï¸âƒ£ å‰ç«¯å±•ç¤º
```
â†’ è¿”å›å“åº”ç»™ç”¨æˆ·
```

---

## ğŸ—„ï¸ æ•°æ®ç»“æ„ï¼ˆFirestoreï¼‰

```
users/{user_id}/
  â””â”€â”€ sessions/{session_id}/
      â”œâ”€â”€ created_at
      â”œâ”€â”€ updated_at
      â”‚
      â”œâ”€â”€ messages/{message_id}/
      â”‚   â”œâ”€â”€ role: "user" | "assistant"
      â”‚   â”œâ”€â”€ content: æ¶ˆæ¯å†…å®¹
      â”‚   â”œâ”€â”€ timestamp
      â”‚   â”œâ”€â”€ is_archived: æ˜¯å¦å·²å½’æ¡£
      â”‚   â””â”€â”€ thread_id: å½’æ¡£åå…³è”çš„ä¸»é¢˜ID
      â”‚
      â””â”€â”€ topics/{thread_id}/
          â”œâ”€â”€ title: ä¸»é¢˜æ ‡é¢˜
          â”œâ”€â”€ summary: ç®€çŸ­æ‘˜è¦
          â”œâ”€â”€ current_artifact: å½“å‰Artifactå†…å®¹
          â”œâ”€â”€ created_at
          â”‚
          â””â”€â”€ artifact_versions/{version_id}/
              â”œâ”€â”€ content: Artifactå†…å®¹
              â”œâ”€â”€ created_at
              â””â”€â”€ message_ids: ç”Ÿæˆè¯¥ç‰ˆæœ¬çš„æ¶ˆæ¯IDåˆ—è¡¨
```

---

## âš™ï¸ å…³é”®é…ç½®ï¼ˆconfig.pyï¼‰

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `active_window_size` | 20 | æ´»è·ƒçª—å£å¤§å°ï¼ˆæœ€è¿‘Næ¡æ¶ˆæ¯ï¼‰ |
| `archive_threshold` | 10 | å½’æ¡£é˜ˆå€¼ï¼ˆæœªå½’æ¡£æ¶ˆæ¯æ•°ï¼‰ |
| `max_context_retry` | 3 | ä¸Šä¸‹æ–‡æ£€ç´¢æœ€å¤§é‡è¯•æ¬¡æ•° |
| `context_request_pattern` | `NEED_CONTEXT:` | AIè¯·æ±‚ä¸Šä¸‹æ–‡çš„æ ‡è®° |

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### åç«¯
```bash
cd backend
source venv/bin/activate
pip install -r requirements.txt
./run.sh
```

### å‰ç«¯
```bash
cd frontend
python -m http.server 8080
# è®¿é—® http://localhost:8080
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q: å¯¹è¯å¤ªé•¿ä¼šæ€æ ·ï¼Ÿ
A: ç³»ç»Ÿä¼šè‡ªåŠ¨å½’æ¡£æ—§æ¶ˆæ¯ä¸ºArtifactï¼Œä¿æŒæ´»è·ƒçª—å£åªæœ‰æœ€è¿‘20æ¡æ¶ˆæ¯

### Q: AIå¦‚ä½•è·å–å†å²ä¿¡æ¯ï¼Ÿ
A: AIåœ¨å›å¤ä¸­æ ‡è®°`NEED_CONTEXT:å…³é”®è¯`ï¼Œç³»ç»Ÿä¼šæŸ¥æ‰¾ç›¸å…³Artifactå¹¶é‡æ–°ç”Ÿæˆå›å¤

### Q: Artifactæ˜¯ä»€ä¹ˆï¼Ÿ
A: Artifactæ˜¯å¯¹ä¸€æ®µå†å²å¯¹è¯çš„ç»“æ„åŒ–æ€»ç»“ï¼Œé€šå¸¸åŒ…å«ç« èŠ‚æ ‡é¢˜å’Œå†…å®¹

### Q: ä¸»é¢˜(Topic)å’Œä¼šè¯(Session)çš„å…³ç³»ï¼Ÿ
A: ä¸€ä¸ªSessionå¯ä»¥æœ‰å¤šä¸ªTopicï¼Œæ¯ä¸ªTopicä»£è¡¨å½’æ¡£åçš„ä¸€ä¸ªå¯¹è¯ä¸»é¢˜

---

## ğŸ“š ä¸‹ä¸€æ­¥

- âœ… **ç†è§£æµç¨‹**: é‡ç‚¹çœ‹ `context_loop.py`
- âœ… **æ£€æŸ¥çŠ¶æ€**: æŸ¥çœ‹ `01-å¿«é€Ÿæ£€æŸ¥æ¸…å•.md`
- âœ… **ä¿®æ”¹é…ç½®**: ç¼–è¾‘ `backend/app/config.py`
- âœ… **æŸ¥çœ‹æ¶æ„**: æ‰“å¼€ `æ¶æ„å›¾.md`ï¼ˆéœ€è¦Mermaidæ”¯æŒï¼‰

---

**ğŸ’¡ æç¤º**: å½“ä½ æ„Ÿè§‰è¿·å¤±æ—¶ï¼Œå›åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œ5åˆ†é’Ÿå†…é‡æ–°æŒæ¡å…¨å±€ï¼
